---
title: "An√°lise de Dados"
author: "Willams Sousa Brito"
date: "20/10/2025"
output:
  github_document: default
  pdf_document: default
  html_document: default
  word_document: default
---

## **Estudo do Pre√ßo do combust√≠vel automotivo no Brasil em 1¬∫ Sem/2025**

### Uso da Ferramenta de an√°lise de dados - Software R

### **Objetivos da An√°lise:**

#### ‚û°Ô∏è **Demonstrar atrav√©s da an√°lise exploratoria de dados (EDA) o processo para contar uma hist√≥ria a partir fontes de dados brutos**

#### ‚û°Ô∏è **Explorar nos dados, descobertas, estrutura√ß√£o, limpeza, uni√£o, valida√ß√£o e apresenta√ß√£o**

#### ‚û°Ô∏è **Verificar qualidade, entender o conjunto de dados para extrair insights**

#### ‚û°Ô∏è **Utilizar visualiza√ß√µes de dados geogr√°ficos e m√©todos estat√≠sticos para explorar os dados**

#### ‚û°Ô∏è **Utilizar ferramenta de BI (Tableau) para visualiza√ß√µes de dados**

### **Fonte de Dados:**

#### 1- ANP: Dados do Pre√ßo do Combust√≠vel Automotivo - 1¬∫ semestre do ano de 2025.

#### Acesso atrav√©s do Portal de Dados Abertos, dados da Ag√™ncia Nacional do Petr√≥leo, G√°s Natural e Biocombust√≠veis - ANP

#### Link da Planilha <https://dados.gov.br/dados/conjuntos-dados/serie-historica-de-precos-de-combustiveis-e-de-glp>

#### 2- IBGE: Dados de localiza√ß√£o dos Munic√≠pios.

#### Acesso atrav√©s da Pacote de Dados Geogr√°ficos Brasileiros (geobr), permite coletar dados dos shapefiles do Instituto Brasileiro de Geografia e Estat√≠stica (IBGE) e outros conjuntos oficiais de dados espaciais do Brasil

#### Link da BigQuery <https://basedosdados.org/dataset/49ace9c8-ae2d-454b-bed9-9b9492a3a642?table=b39609b4-ffb2-4b4f-a182-47b0d160037b>

### **Importa√ß√µes pacotes e dados para an√°lise:**

### üéØ Objetivos

#### - Instalar e importar pacotes relevantes para an√°lise.

#### - Carregar os dados em um DataFrame, converte arquivos em estruturas manipulaveis.

#### - Realizar an√°lise pr√©via dos dados carregados.

#### - Identificar problemas como codifica√ß√£o de texto, separadores, tipos de vari√°veis.

#### ‚úîÔ∏èInstalar pacotes utilizando a fun√ß√£o install.packages().

```{r}
#Instalar pacotes utilizando 

#install.packages("readr")
#install.packages("dplyr")
#install.packages("tidyverse")
#install.packages("naniar")
#install.packages("readxl")
#install.packages("leaflet")
#install.packages("openxlsx")

#grafico de geolocaliza√ß√£o

#install.packages("geobr")
#install.packages("sf")
```

#### ‚úîÔ∏èImportar pacotes utilizando a fun√ß√£o library().

```{r}
#Importar pacotes

library(openxlsx)
library(naniar)
library(readr)
library(readxl)
library(dplyr)
library(ggplot2)
library(plotly)
library(httr)
library(jsonlite)
library(tidyverse)
library(leaflet)
library(geobr)
library(sf)
library(stringi)

```

#### ‚úîÔ∏è**Carregar dados em um DataFrame.**

#### O 1¬∫ conjunto de dados escolhido est√° no formato de um arquivo xls (Excel), disponivel para Download no Portal de Dados Abertos.

```{r}
#Carregar os dados em um DataFrame e salvar em uma vari√°vel chamada (dados.anp) e realizar an√°lise pr√©via dos dados.
Precos_semestrais_AUTOMOTIVOS_2025_01 <- read_excel("Precos semestrais - AUTOMOTIVOS_2025.01.xlsx")

#salvar em uma vari√°vel chamada (dados.anp)
dados.anp<-Precos_semestrais_AUTOMOTIVOS_2025_01

#A fun√ß√£o str(), exibe informa√ß√µes b√°sica dos dados importados,como o tipo de objeto (ex: data frame, vetor, lista), n√∫mero de elementos ou dimens√µes, nomes das vari√°veis e seus tipos de dados e uma amostra dos dados.
#revis√£o b√°sica dos dados importados
str(dados.anp) #nova variavel geografica incluida

```

#### O banco de dados dos pre√ßos dos combustiveis √© um data.frame, possui 420.409 linhas e 16 Colunas(Variaveis), a maioria das variaveis s√£o qualitativas e a vari√°vel "Valor de Venda" a √∫nica num√©rica, do tipo cont√≠nua".

#### O 2¬∫ conjunto de dados escolhido est√° disponivel na BigQuery plataforma de an√°lise de dados do Google, os dados podem ser acessados pelo pacote(geobr).

```{r}
# Carregar os dados em um DataFrame e salvar em uma vari√°vel chamada (municipio) e realizar an√°lise pr√©via dos dados.

municipio <- read_municipality(year = 2024) #a fun√ß√£o permite escolha do ano em que o dado foi coletado.
str(municipio)#informa√ß√µes gerais

```

#### O banco de dados geografico √© um data.frame com 5.571 linhas e 8 Colunas(Variaveis), s√£o variaveis qualitativas e uma vari√°vel especial "geom", composta por uma lista de geometrias espaciais (classe - sf).

#### A variavel "geom", contem uma lista de dados, para a presente an√°lise iremos utilizar a coordenadas de longitude e latitude dos munic√≠pios.

```{r}
# Adicionar coordenadas de latitude e longitude no data.frame
# 1- Calcular os centroides (ponto central de cada munic√≠pio)
mun_centroids <- st_centroid(municipio)

# 2- Extrair coordenadas de latitude e longitude
coords <- st_coordinates(mun_centroids)

# Adicionar as coordenadas ao dataframe original
municipio <- municipio %>% mutate(longitude = coords[,1], latitude = coords[,2])

# Visualizar os dados
head(municipio,10)
```

### **Estrutura√ß√£o e Limpeza dos dados**

### üéØ Objetivos

#### - Corrigir inconsist√™ncias, padronizar nomes de colunas e uniformizar valores

#### - Unir os dois data.frame criados (dados.anp e municipios), realizar an√°lise pr√©via do novo data.frame

#### ‚úîÔ∏è**Uni√£o do 1¬∫ e 2¬∫ Conjunto de dados**

#### An√°lise inicial dos dados sugere que a varivel CHAVE principal √© o "NOME DO MUNICIPIO", entretanto a ocorr√™ncia de nomes de munic√çpios iguais em diferentes regi√µes √© comum no Brasil, dessa maneira ao utilizar a segunda chave "SIGLA DO ESTADO", ira garantir a correta uni√£o dos dados.

```{r}
#Padronizar dos nomes de Variaveis e uniformizar valores.
#Para realizar a uni√£o dos conjuntos de dados, inicialmente as variaveis "Nome do Municipio" e "Nome do Estado" dever√£o estar Padronizadas.

#Padroniza√ß√£o dos nomes de Variaveis
#os nomes de variaveis est√£o com idiomas e padrao de escrita diferentes.
names(dados.anp)
names(municipio)

#Renomeando os nomes de variaveis do 2¬∫ conjunto de daods de acordo com o 1¬∫.
municipio <- setNames(municipio, c("codigo do Municipio", "Municipio", "Estado - Codigo", "Estado - Sigla","Nome do Estado","Regiao - Codigo","Nome da Regiao","geom","longitude","latitude" ))
names(municipio)


# An√°lise previa das variaveis Chaves.

#Chave:Nomes dos Municipios
head(dados.anp$Municipio,15) #A variavel:Municipio, contem nomes em letras mai√∫sculas e sem acentos.
head(municipio$Municipio,15)  #A variavel:name_muni, contem nomes em letras min√∫sculas e com acentos.  

# 1¬™- Padronizar tudo em letras MAIUSCULAS.
dados.anp <- dados.anp %>% mutate(Municipio = toupper(Municipio))
municipio <- municipio %>% mutate(Municipio = toupper(Municipio))

# 2¬™-padronizar tudo em palavras sem acentua√ß√£o.
dados.anp <- dados.anp %>% mutate(Municipio = stri_trans_general(Municipio, "Latin-ASCII"))
municipio <- municipio %>% mutate(Municipio = stri_trans_general(Municipio, "Latin-ASCII"))

#verificando resultado
head(dados.anp$Municipio,15) #A variavel:Municipio, contem nomes em letras min√∫sculas e sem acentos.
head(municipio$Municipio,15)  #A variavel:name_muni, contem nomes em letras min√∫sculas e sem acentos.  

#Chave:Nomes dos Estados j√° est√£o padronizados
head(dados.anp$`Estado - Sigla`,15)    
head(municipio$`Estado - Sigla`,15)    


```

#### üéØ Unir os dados e avaliar o resultado

#### O novo conjunto de dados ser√° salvo com o mesmo nome do 1¬∫ conjunto (dados.anp), o m√©todo utilizado (Left join) combina duas tabelas mantendo todas as linhas da tabela da esquerda e adicionando colunas da tabela da direita quando as chaves coincidem. Linhas da esquerda sem correspond√™ncia recebem valores ausentes nas colunas adicionadas

```{r}
#verificar a dimens√£o dos conjuntos de dados antes da uni√£o
dim(dados.anp) #Linhas:420409 e Colunas:16
dim(municipio) #Linhas:5571 e  Coliunas:8

#verificar os nomes de veriaveis
names(dados.anp)
names(municipio)

#realizar a uni√£o dos conjuntos de dados, usando duas chaves
dados.anp <- left_join(dados.anp,municipio, by = c("Municipio","Estado - Sigla"))

#verificar anti_join, para listar chaves nao correspondentes e descobrir as possiveis causas
dados.anp1 <- anti_join(dados.anp,municipio, by = c("Municipio","Estado - Sigla"))
#View(dados.anp1) #existe um municipio (santana do livramento) do RS que n√£o possui dados do IBGE registrados em 2024. 
head(dados.anp1) #817 linhas 
#View(dados.anp1)

#verificando quantidades de registros 
table(dados.anp$`Nome do Estado`) #Rio Grande do SUl:31296  
table(dados.anp$`Estado - Sigla`) #Rio Grande do SUl:32113

table(dados.anp$`Nome da Regiao`) #Sul:72714
table(dados.anp$`Regiao - Sigla`)  #Sul: 73531

#Substituir (imputar) valores ausentes para as Variaveis Nome da Regiao e Nome do Estado, referente ao municipio Santana do Livramento
#Essa a√ß√£o evita tabelas com NA, quando resumidas por Nome do Estado e Nome da Regi√£o.
dados.anp$`Nome do Estado` <- replace_na(dados.anp$`Nome do Estado`, "Rio Grande do Sul")
dados.anp$`Nome da Regiao` <- replace_na(dados.anp$`Nome da Regiao`, "Sul")

#quantidades apos alteracao
length(dados.anp$`Nome do Estado`[dados.anp$`Nome do Estado`=="Rio Grande do Sul"])
length(dados.anp$`Nome da Regiao`[dados.anp$`Nome da Regiao`=="Sul"])


```

#### Visualizar informa√ß√µes de variaveis(quantidade,nomes,tipo de dados,primeiros valores) e verificar a dimens√£o do novo conjunto.

```{r}
dim(dados.anp)  #o novo conjunto de dados contem a mesma quantidae de linhas do 1¬∫ conjunto (420.409) e 22 variaveis em estudo, 16 (1¬∫ Conjunto) considerando as duas  chaves + 6 (2¬∫ Conjunto)
head(dados.anp, 10) #avaliando as 10 primeiras linhas
names(dados.anp)
#View(dados.anp)
str(dados.anp)
```

#### Resumo descritico para verificar a estrutura dos dados

```{r}
summary(dados.anp) #Resumo descritivo apontou NA's valores nao observados que devem ser verificado o tratamento adequado para essas variaveis. 

#contagem de dados ausentes(NA)  E NULOS(NULL) por coluna

# Identificar quais variaveis apresentam dados NULL
sapply(dados.anp, is.null) #sem dados Null

#verifica√ß√£o dados ausentes
colSums(is.na(dados.anp))
#A contagem de NA's, evidencia o resultado da jun√ß√£o de dados, 817 linhas do caso especifico do municipio (santana do livramento) do RS que nao possui dados do IBGE registrados em 2024. 
gg_miss_var(dados.anp)
# Gr√°fico de barras por vari√°vel, identificamos que a variavel "valor de compras" e "Complemento" apresentam um n√∫mero elevado de dados ausentes, portanto essas variaveis n√£o s√£o uteis para an√°lise.
```

#### Eliminar da an√°lise algumas variaveis que n√£o s√£o interesantes para o estudo do preco do combustivel, remover colunas pelo nome.

```{r}
names(dados.anp)
dados.anp <- dados.anp %>% select(-`Nome da Rua`,-geom,-Complemento,-`Valor de Compra`);dados.anp
names(dados.anp)
```

#### Para visualiza√ß√£o de dados utilizaremos o Tableau (Ferramenta de BI),para isso exportaremos os dados para uma planilha (dados.anp_para_tableau)

```{r}
# Adicionando uma coluna de ID para cada linha unidade amostral de locais de revenda
dados.anp <- dados.anp %>%
  mutate(id_local_revenda = row_number())

write.xlsx(dados.anp, "dados.anp_para_tableau.xlsx")
```

### **Criando uma hist√≥ria com a estat√≠stica, transformando n√∫meros em conhecimento, padr√µes em descobertas.**

#### Visualiza√ß√£o Interativa

#### Histograma para visualiziar a distribui√ß√£o do Pre√ßo do Combust√≠vel

##### üëâ Clique no link abaixo para acessar o dashboard completo no Tableau:

##### [Visualizar no Tableau](https://public.tableau.com/views/AnlisePreoCombustiveis/Histograma_Preco?:language=pt-BR&:sid=&:redirect=auth&:display_count=n&:origin=viz_share_link)

------------------------------------------------------------------------

![](Histograma_Preco.png){width="705"}

##### A distribuicao dos das dados sugere dois conjuntos distintos, apresentando dois picos.

##### Um histograma com dois picos indica uma distribui√ß√£o bimodal ‚Äî ou seja, os dados t√™m dois agrupamentos principais de frequ√™ncia. Isso pode sugerir a presen√ßa de dois grupos distintos dentro do conjunto de dados.

##### Separando os dados: analisar os dois picos separadamente pode revelar padr√µes distintos.

##### Visulizar o valor de venda e o tipo de produto.

#### Visualiza√ß√£o Interativa

#### Boxplot para visualizar a distribui√ß√£o do Pre√ßo por Tipo de Combust√≠vel

##### üëâ Clique no link abaixo para acessar o dashboard completo no Tableau:

##### [Visualizar no Tableau](https://public.tableau.com/views/AnlisePreoCombustiveis/BoxplotVVMunicpios3?:language=pt-BR&:sid=&:redirect=auth&:display_count=n&:origin=viz_share_link)

------------------------------------------------------------------------

![](Boxplot_tipode%20produto.png)

##### A an√°lise do Boxplot sugere que existe dois distintos de valores de combustiveis, o primeiro grupo com valores mais elevados (DIESEL, DIESEL S10, GASOLINA, GASOLINA ADITIVADA) e o segundo grupo com valores mais baixos (ETANAL e GNV).

##### O gr√°fico mostra presen√ßa de dados discrepantes (outliers), s√£o valores que se desviam significativamente do padr√£o da maioria dos dados.

#### Estat√≠sticas do valor de venda dos combustiveis

```{r}
#ESTAT√çSTICAS - C√ÅLCULO DE M√âTRICAS 

#sele√ß√£o de variaveis num√©ricas para explora√ß√£o inicial 

sapply(dados.anp %>% select(where(is.numeric)), function(x) c(
  n = sum(!is.na(x)),          
  mean = mean(x, na.rm = TRUE),
  sd = sd(x, na.rm = TRUE),
  median = median(x, na.rm = TRUE),
  p25 = quantile(x, 0.25, na.rm = TRUE),
  p75 = quantile(x, 0.75, na.rm = TRUE),
  min = min(x, na.rm = TRUE),
  max = max(x, na.rm = TRUE)
))

#Do conjunto de  dados num√©ricos, somente a variaviavel valor de venda √© interessante ser analisada.  
summary(dados.anp$`Valor de Venda`) #a fun√ß√£o mostra estat√≠sticas b√°sicas como m√≠nimo, 1¬∫ quartil, mediana, m√©dia, 3¬∫ quartil e m√°ximo.
```

##### O resumo indica que no geral existe uma varia√ß√£o consider√°vel no pre√ßo dos combustiveis, m√≠nimo R\$ 3.1 a R\$ 9.4, vejamos as estat√≠sticas por tipo de produto.

```{r}
#Resumo de estat√≠sticas descritivas do valor de venda dos combustiveis por tipo de Produto

dados.anp%>%  group_by(Produto) %>%
  summarise(
    n = n(),
    n_na = sum(!is.na(`Valor de Venda`)),
    Min = min(`Valor de Venda`, na.rm = TRUE),
    Q1 = quantile(`Valor de Venda`, 0.25, na.rm = TRUE),
    Mediana = median(`Valor de Venda`, na.rm = TRUE),
    Media = mean(`Valor de Venda`, na.rm = TRUE),
    Q3 = quantile(`Valor de Venda`, 0.75, na.rm = TRUE),
    Max = max(`Valor de Venda`, na.rm = TRUE),
    sd_preco = sd(`Valor de Venda`, na.rm = TRUE))

```

##### Descobertas do resumo estat√≠stico:

##### - A quantidade de valores coletados na amostra, indica que a Gasolina tem a maior quantidade, enquanto o GNV tem a menor;

##### - O menor valor de combustivel √© do Etanol (R\$3.19) e o maior valor coletado √© da Gasolina Aditivida (R\$9.49);

##### - As m√©dias e medianas menores (R\$4.48 e R\$4.47) s√£o do Etanol e as maiores (R\$6.48 e R\$6.49) s√£o da Gasolina Aditivida.

```{r}
#Resumo de estat√≠sticas descritivas do valor de venda dos combustiveis por Regi√£o

dados.anp%>%  group_by(`Regiao - Sigla`) %>%
  summarise(
    n = n(),
    n_na = sum(!is.na(`Valor de Venda`)),
    Min = min(`Valor de Venda`, na.rm = TRUE),
    Q1 = quantile(`Valor de Venda`, 0.25, na.rm = TRUE),
    Mediana = median(`Valor de Venda`, na.rm = TRUE),
    M√©dia = mean(`Valor de Venda`, na.rm = TRUE),
    Q3 = quantile(`Valor de Venda`, 0.75, na.rm = TRUE),
    Max = max(`Valor de Venda`, na.rm = TRUE),
    sd_preco = sd(`Valor de Venda`, na.rm = TRUE))

```

#### Descobertas do resumo estat√≠stico:

##### - A amostra indica que a Regi√£o Sudeste (SE) concentra a maior quantidade de observa√ß√µes, essa Regi√£o √© a mais populosa do Brasil;

##### - As m√©dias e medianas menores (R\$5.72 e R\$5.99) s√£o do Sudeste e as maiores (R\$6.54 e R\$6.69) s√£o do Norte (N)

#### C√°lculo de m√©dias agrupadas por categorias para incluir no data.set

```{r}
dados.anp <- dados.anp %>%
  group_by(`Regiao - Sigla`) %>%
  mutate(media_regiao = mean(`Valor de Venda`, na.rm = TRUE)) %>%
  group_by(`Estado - Sigla`, .add = TRUE) %>%
  mutate(media_estado = mean(`Valor de Venda`, na.rm = TRUE)) %>%
  group_by(Municipio, `Estado - Sigla`, `Regiao - Sigla`, .add = TRUE) %>%
  mutate(media_municipio = mean(`Valor de Venda`, na.rm = TRUE)) %>%
  ungroup()

# Conferir resultado
head(dados.anp[,19:24],10)

#EXPORTAR PARA TABLEAU
write.xlsx(dados.anp, "dados.anp_para_tableau.xlsx")

```

#### Ranking do valor m√©dio dos combust√≠veis por Municipio

```{r}

## 1. Calcular m√©dia por Municipio
media_municipio <- dados.anp %>%
 group_by(`codigo do Municipio`,Municipio) %>%
 summarise(valor_medio = mean(`Valor de Venda`), .groups = "drop")%>%
  arrange(desc(valor_medio))
media_municipio

# 5 primeiros
head(media_municipio, 5)

# 5 √∫ltimos
tail(media_municipio, 5)


```

#### Ranking do valor m√©dio dos combust√≠veis por Estado

```{r}

## 1. Calcular m√©dia por Estado
media_estado <- dados.anp %>%
 group_by(`Nome do Estado`) %>%
 summarise(valor_medio = mean(`Valor de Venda`), .groups = "drop")%>%
  arrange(desc(valor_medio))
media_estado

# 5 primeiros
head(media_estado, 5)

# 5 √∫ltimos
tail(media_estado, 5)


```

#### Ranking do valor m√©dio dos combust√≠veis por Regi√£o

```{r}

## 1. Calcular m√©dia por Regi√£o
media_regiao <- dados.anp %>%
 group_by(`Nome da Regiao`) %>%
 summarise(valor_medio = mean(`Valor de Venda`), .groups = "drop")%>%
  arrange(desc(valor_medio))
media_regiao


```

### **Compreender o pre√ßo do combust√≠vel a n√≠vel nacional com visualiza√ß√µes geogr√°ficas no Tableau.**

#### Veja de forma interativa o cen√°rio de Pre√ßos dos Combust√≠veis.

##### üëâ Clique no link abaixo para acessar o dashboard completo no Tableau:

##### [Visualizar no Tableau](https://public.tableau.com/views/AnlisePreoCombustiveis/Histria1?:language=pt-BR&:sid=&:redirect=auth&:display_count=n&:origin=viz_share_link)

![](Hist√≥ria_Painel2){width="796"}

------------------------------------------------------------------------

![](Hist√≥ria%20_Painel.png)

### **Descorbertas da an√°lise**

#### - As Regi√µes do Brasil que possuem os maiores e menores pre√ßos de combust√≠veis;

#### - Regi√µes no pa√≠s com maior consumo de combust√≠veis;

#### - Regi√µes com maiores varia√ß√µes de pre√ßo;

#### - Tipo de combust√≠veis mais consumidos no pa√≠s;

#### - Munic√≠pios com alto pre√ßos em rela√ß√£o ao Estado;

#### - Revendedoras com m√©dias de valor de venda discrepantes.
